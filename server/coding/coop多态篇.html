<!DOCTYPE html>
<html lang="cn">
<head>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />

	<link rel="dns-prefetch" href="//hm.baidu.com"/>
	<link rel="dns-prefetch" href="//disqus.com"/>
	<link rel="dns-prefetch" href="//a.disquscdn.com"/>

	<meta name="Keywords" content="yinwoods,殷成涛,个人博客,郑州大学,cpp"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"/>
	<meta content="yes" name="apple-mobile-web-app-capable" />
	<meta content="black" name="apple-mobile-web-app-status-bar-style" />
	<meta content="telephone=no" name="format-detection" />
	
	<meta name="author" content="yinwoods">

	<link rel="alternate" type="application/rss+xml" title="yinwoods Feed" href="/rss.xml" />
	<link rel="apple-touch-icon-precomposed" href="/img/icon.png">
	<link rel="apple-touch-icon-precomposed" href="/img/icon-16.png" sizes="16x16" />
	<link rel="apple-touch-icon-precomposed" href="/img/icon-24.png" sizes="24x24" />
	<link rel="apple-touch-icon-precomposed" href="/img/icon-32.png" sizes="32x32" />
	<link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">

    <title>C++【OOP】多态篇 | yinwoods</title>
  
	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/rouge.css">
	<link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
	<script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
		(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
		e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
		})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

		_st('install','csxq-8xzb6tiaQ1dQaGs','2.0.0');
	</script>
</head>


<body>
	<div id="container" class="container">
		<div id="content" class="content">
						<nav class="navbar">
				<div class="pull-left">
					<button id="btnMenu" type="button" class="btn btn-default btn-sm btn-menu">
						<span class="glyphicon glyphicon-th-list" aria-hidden="true"></span>	菜 单
					</button>
				</div>
				<ul class="pull-center">
					<li class="active"><a href="/">博客</a></li>
                    <li><a href="/about.html">关于我</a></li>
				</ul>
				<div class="pull-right">
					<button type="button" class="btn btn-default btn-sm btn-list">
						<a href="/book-movie-list/booklist.html">
							<span class="glyphicon glyphicon-list-alt"></span> 书单/影单  
						</a>
					</button>
				</div>
			</nav>

			<header class="post-header">
        <div class="hd-img">
                <img src="http://7xlh6u.com1.z0.glb.clouddn.com/bg35.jpg" alt="背景图片">
        </div>

        <div class="title">
           <h1>C++【OOP】多态篇</h1>
        </div>
</header>
<button id="btnArrow" class="btn-arrow" data-info="点击显示文章"><i class="icon icon-arrow-down">&#xe619;</i></button>
<div class="post-title">
	<h1>C++【OOP】多态篇</h1>
	
	<p>作者: <a target="_blank" href="http://blog.yinwoods.com/"><strong>yinwoods</strong></a>&nbsp;&nbsp;&nbsp;
		分类: <a target="_blank" href="http://blog.yinwoods.com/coding.html"><strong>coding</strong></a>&nbsp;&nbsp;&nbsp;
		日期: <strong>2015年10月06日</strong>&nbsp;&nbsp;&nbsp;
         <ul class="tags post-tags">
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    <li><a href="/tags/cpp/index.html">cpp<span>8</span></a></li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            </ul></p>
</div>
    

    <article class="post-content">
        <hr class="post-end-left"><p class="post-end">开始</p><hr class="post-end-right"/>
        <div>
            <h3>多态概念</h3>

<p><strong>多态：相同对象收到不同消息或不同对象收到相同消息时产生不同的动作（不同对象对相同命令执行不同操作）。</strong></p>

<p>多态可分为静态多态、动态多态。</p>

<p>静态多态又称为早绑定，编译时已确定，比如函数的重载。</p>

<p><code>CPP
class Rect {
    int calcArea(int width);
    int calcArea(int width, int height);
}
</code></p>

<p>动态绑定又称为晚绑定，以封装、继承为基础。可借用虚函数实现。</p>

<h3>虚函数</h3>

<p>```CPP
class Shape {
public:
    virtual double calcArea() {//虚函数定义需前加关键字virtual
        cout &lt;&lt; &quot;calcArea&quot; &lt;&lt; endl;
        return 0;
    }
};</p>

<p>class Circle: public Shape {
public:
    Circle(double r) {
            m<em>dR = r;
            m</em>pCenter = new Coordinate(1, 2);
        }
    [virtual] double calcArea();//继承后virtual关键字可加可不加，但为了易读性，建议加上
private:
    double m<em>dR;
    Coordinate *m</em>pCenter;
}</p>

<p>class Rect: public Shape {
public:
    Rect(double width, double height);
    [virtual] double calcArea();
private:
    double m<em>dWidth;
    double m</em>dHeight;
}</p>

<p>int main(void) {
    Shape *shape1 = new Circle(4.0);
    Shape *shape2 = new Rect(3.0, 5.0);
    shape1-&gt;calcArea();
    shape2-&gt;calcArea();
    //如果没有virtual，那么调用的都是父类的calcArea()成员函数
    delete shape1;
    delete shape2;
    return 0;
}</p>

<p>```</p>

<p>但是使用虚函数需要<strong>注意：动态多态可能导致内存泄露</strong>，这种情况发生在父类指针操作子类虚函数后释放指针销毁子类对象时，只会执行父类的析构函数，从而导致子类中内存泄露。（例如上例中Circle构造函数实例化m<em>pCenter，m</em>pCenter为泄露内存）</p>

<p>为了解决上述问题，可以引进<strong>虚析构函数</strong>，用<code>virtual</code>修饰父类析构函数，这样在执行父类的虚析构函数时会先自动调用子类的析构函数。</p>

<p>对于virtual关键字有以下限制：</p>

<blockquote>
<ul>
<li><p>1、不能修饰普通函数（全局函数）</p></li>
<li><p>2、不能修饰静态成员函数</p></li>
<li><p>3、修饰内联函数时，会使<code>inline</code>失去作用</p></li>
<li><p>4、不能修饰构造函数</p></li>
</ul>
</blockquote>

<p>对于对象的大小，只计算数据成员所占大小，不考虑成员函数。</p>

<h3>虚函数实现原理</h3>

<p>首先我们需要知道一个概念，当指针指向函数时，实际指向的是函数的入口地址。</p>

<p>因此虚函数原理：实例化对象时，有一个虚函数表指针成员，指向虚函数表，从而找到虚函数。（<strong>虚函数表指针占用对象开始处的四个字节</strong>）</p>

<h3>纯虚函数与抽象类</h3>

<p><code>CPP
class Shape {//抽象类
public:
        virtual double calcArea() = 0;//纯虚函数
};
</code></p>

<p>纯虚函数的定义即在虚函数的基础上后加<code>= 0</code>。</p>

<p>抽象类：含有纯虚函数的类。</p>

<p>抽象类不能实例化对象，抽象类的子类也可以是抽象类。只有当抽象类子类实现了所有的纯虚函数，才可以实例化。</p>

<p>抽象类、纯虚函数的作用：确保基类不能实例化对象。</p>

<h3>接口类</h3>

<p>接口类：仅含有纯虚函数的类（成员函数都是纯虚函数）。</p>

<p><code>接口类更多表达一种能力或协议。</code></p>

<p>例子如下：</p>

<p>```CPP
class Flyable {
public:
    virtual void takeoff() = 0;
    virtual void land() = 0;
};</p>

<hr>

<p>class Bird: public Flyable {
public:
    ....
    virtual void takeoff() {...}
    virtual void land() {...}
}
```</p>

<h3>RTTI（运行时类型识别-<code>Run Time Type Identification</code>）</h3>

<p>使用typeid()、dynamic_cast<Class>来完成。见下例：</p>

<p>```CPP
class Flyable {
public:
    virtual void takeoff() = 0;
    virtual void land() = 0;
};</p>

<p>class Bird: public Flyable {
public:
    void foraging() {...}
    virtual void takeoff() {...}
    virtual void land() {...}
private:
    ... ...
};</p>

<p>class Plane : public Flyable {
public:
    void carry() {...}
    virtual void takeoff() {...}
    virtual void land() {...}
};</p>

<p>void doSomething(Flyable <em>obj) {
    obj-&gt;takeoff();
    使用RTTI来完成下面的任务：
    cout &lt;&lt; typeid(</em>obj).name() &lt;&lt; endl;//打印对象类型
    if(typeid(<em>obj) == typeid(Bird)) {
        Bird *bird = dynamic_cast<Bird *>(obj);//转为Bird指针
        bird-&gt;foraging();
    }
    /</em>
    if(Bird) obj-&gt;foraging();
    if(Plane) obj-&gt;carry();
    */
    obj-&gt;land();
}
```</p>

<p>dynamic_cast注意事项：</p>

<blockquote>
<ul>
<li><p>只能用于指针和引用转换</p></li>
<li><p>要转换的类型中必须包含虚函数</p></li>
<li><p>转换成功返回子类地址，失败返回NULL</p></li>
</ul>
</blockquote>

<p>typeid注意事项：</p>

<blockquote>
<ul>
<li><p>type<em>id返回一个type</em>info对象的引用</p></li>
<li><p>如果想要通过基类指针指向派生类的数据类型，基类必须带有虚函数</p></li>
<li><p>只能获取对象的实际类型</p></li>
</ul>
</blockquote>

<h3>异常处理</h3>

<p>异常：程序运行期出现的错误。</p>

<p>异常处理：对可能发生异常的地方做出预见性的安排。</p>

<p>C++ OOP特性还可参考本站其他相关博文：</p>

<blockquote>
<p><a href="http://blog.yinwoods.com/coding/c%E4%B8%AD%E7%9A%84%E5%A4%9A%E6%80%81.html">C++ 【oop】封装篇</a></p>

<p><a href="http://blog.yinwoods.com/coding/c-oop%E7%BB%A7%E6%89%BF%E7%AF%87.html">C++ 【oop】继承篇</a></p>

<p><a href="http://blog.yinwoods.com/coding/coop%E6%A8%A1%E6%9D%BF%E7%AF%87.html">C++ 【oop】模板篇</a></p>
</blockquote>

        </div>
        <hr class="post-end-left"><p class="post-end">结束</p><hr class="post-end-right"/>
        <div class="post-footer">
            
            <p class="post-footer-previous">上一篇 ： <a class="entry-more" href="/coding/c-oop%E7%BB%A7%E6%89%BF%E7%AF%87.html">C++ 【OOP】继承篇</a></p>
            
            
            <p class="post-footer-next">下一篇 ： <a class="entry-more" href="/coding/coop%E6%A8%A1%E6%9D%BF%E7%AF%87.html">C++【OOP】模板篇</a></p>
            
        </div>
    <!-- JiaThis Button BEGIN -->
    <div class="jiathis_style">
        <span style="font-family:sans-serif; color:#009966">分享到：</span>
        <a class="jiathis_button_weixin share_button" href="#"></a>
        <a class="jiathis_button_tsina share_button" href="#"></a>
        <a class="jiathis_button_qzone share_button" href="#"></a>
        <a class="jiathis_button_evernote share_button" href="#"></a>
        <a class="jiathis_button_ydnote share_button" href="#"></a>
        <a class="jiathis_button_pocket share_button" href="#"></a>
        <a class="jiathis_button_douban share_button" href="#"></a>
        <a class="jiathis_button_renren share_button" href="#"></a>
        <a class="jiathis_button_fb share_button" href="#"></a>
        <a class="jiathis_button_linkedin share_button" href="#"></a>
        <a class="jiathis_button_googleplus share_button" href="#"></a>
        <a class="jiathis_button_tumblr share_button" href="#"></a>
        <a class="jiathis_counter_style"></a>
    </div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<script type="text/javascript" src="/js/totop.js" charset="utf-8"></script>
<!-- JiaThis Button END -->
</article>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'yinwoods'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    



		</div>
					<footer class="footer">
				<div class="row">
					<div class="pull-left">
						<a class="avatar" href="/" title="yinwoods">yinwoods</a>
                        			<p class="copyright">2015 ALL RIGHTS RESERVED</p>
					</div>
					
					<div class="pull-center">
						<h4>Powered by <a target="_blank" href="https://github.com/yinwoods">github</a> && <a target="_blank" href="http://jekyllrb.com/">jekyll</a></h4>
					</div>
				</div>
			</footer>

				<nav id="menu" class="menu">
			<ul>
				<li class="logo"><a href="about.html"><img  class="img-circle" height="100px" width="100px" src="/img/about/me.png"></a></li>

				<li><a href="/index.html"><span class="glyphicon glyphicon-home"></span></i> 首页 </a></li>
				
				<li><a href="/coding.html"><span class="glyphicon glyphicon-road"></span></i>  编程之路 </a></li>

				<li><a href="/myshare.html"><span class="glyphicon glyphicon-gift"></span>  我的分享 </a></li>
				
				<li><a href="/diary.html"><span class="glyphicon glyphicon-calendar"></span></i>  生活日志 </a></li>
				
				<li><a href="/book-movie-list/booklist.html"><span class="glyphicon glyphicon-inbox"></span></i>  书单/影单  </a></li>

				<li><a href="/about.html"><span class="glyphicon glyphicon-sunglasses"></span></i>  关于博主 </a></li>

				<li><a href="/friend.html"><span class="glyphicon glyphicon-send"></span></i> 我的朋友 </a></li>

				<li><img class="img-rounded" height="100px" width="100%" src="/img/about/footer.png"></li>

			</ul>
			<button id="btnClose" class="btn-close"></button>

			<div id="SVGMenu" class="svg-menu" 
                data-menu-open="M-7.312,0H15c0,0,66,113.339,66,399.5C81,664.006,15,800,15,800H-7.312V0z;M-7.312,0H100c0,0,0,113.839,0,400c0,264.506,0,400,0,400H-7.312V0z" 
                data-menu-close="M-6,0h101c0,0-90,153.603-90,396.167C2.167,627.579,100,800,100,800H-1V0z;M-7.312,0H100c0,0,0,113.839,0,400c0,264.506,0,400,0,400H-7.312V0z">
				<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 100 800" preserveAspectRatio="none">
					<path d="M-7.312,0H0c0,0,0,113.839,0,400c0,264.506,0,400,0,400h-7.312V0z"/>
				</svg>
			</div>

		</nav>


		<div id="totop">
    			<a title="返回顶部">返回顶部</a>
		</div>
	</div>

	<script type="text/javascript" src="/js/classie.js"></script>

	<script type="text/javascript" src="/js/snap.svg-min.js"></script>
	<script type="text/javascript" src="/js/menuTriggle.js"></script>
	<script type="text/javascript" src="/js/SVGButton.js"></script>

	<script type="text/javascript" src="/js/postTriggle.js"></script>

	
	<script type="text/javascript" src="/js/jquery-2.1.1.min.js"></script>
	<script type="text/javascript" src="/js/totop.js"></script>
	<script type="text/javascript">
		var content = document.querySelector('.content'),
			footer = document.querySelector('.footer'),
			footT  = footer.offsetTop,
			footH  = footer.offsetHeight,
			winH   = window.innerHeight,
			post   = document.querySelectorAll('p');

		if (footT - footH + 100 < winH) {
			content.style.height = '100%';
		};

		for (var i = 0; i < post.length; i++) {
			if (post.item(i).querySelector('img')) {
				post.item(i).style.textIndent = 0;
			};
		};

	</script>
	<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?eefd87bbdb3a5e21ecb7f319769dd8b9";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</body>
</html>
