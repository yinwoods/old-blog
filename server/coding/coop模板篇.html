<!DOCTYPE html>
<html lang="cn">
<head>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />

	<link rel="dns-prefetch" href="//hm.baidu.com"/>
	<link rel="dns-prefetch" href="//disqus.com"/>
	<link rel="dns-prefetch" href="//a.disquscdn.com"/>

	<meta name="Keywords" content="yinwoods,殷成涛,个人博客,郑州大学,cpp"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"/>
	<meta content="yes" name="apple-mobile-web-app-capable" />
	<meta content="black" name="apple-mobile-web-app-status-bar-style" />
	<meta content="telephone=no" name="format-detection" />
	
	<meta name="author" content="yinwoods">

	<link rel="alternate" type="application/rss+xml" title="yinwoods Feed" href="/rss.xml" />
	<link rel="apple-touch-icon-precomposed" href="/img/icon.png">
	<link rel="apple-touch-icon-precomposed" href="/img/icon-16.png" sizes="16x16" />
	<link rel="apple-touch-icon-precomposed" href="/img/icon-24.png" sizes="24x24" />
	<link rel="apple-touch-icon-precomposed" href="/img/icon-32.png" sizes="32x32" />
	<link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">

    <title>C++【OOP】模板篇 | yinwoods</title>
  
	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/rouge.css">
	<link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
	<script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
		(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
		e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
		})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

		_st('install','csxq-8xzb6tiaQ1dQaGs','2.0.0');
	</script>
</head>


<body>
	<div id="container" class="container">
		<div id="content" class="content">
						<nav class="navbar">
				<div class="pull-left">
					<button id="btnMenu" type="button" class="btn btn-default btn-sm btn-menu">
						<span class="glyphicon glyphicon-th-list" aria-hidden="true"></span>	菜 单
					</button>
				</div>
				<ul class="pull-center">
					<li class="active"><a href="/">博客</a></li>
                    <li><a href="/about.html">关于我</a></li>
				</ul>
				<div class="pull-right">
					<button type="button" class="btn btn-default btn-sm btn-list">
						<a href="/book-movie-list/booklist.html">
							<span class="glyphicon glyphicon-list-alt"></span> 书单/影单  
						</a>
					</button>
				</div>
			</nav>

			<header class="post-header">
        <div class="hd-img">
                <img src="http://7xlh6u.com1.z0.glb.clouddn.com/bg36.jpg" alt="背景图片">
        </div>

        <div class="title">
           <h1>C++【OOP】模板篇</h1>
        </div>
</header>
<button id="btnArrow" class="btn-arrow" data-info="点击显示文章"><i class="icon icon-arrow-down">&#xe619;</i></button>
<div class="post-title">
	<h1>C++【OOP】模板篇</h1>
	
	<p>作者: <a target="_blank" href="http://blog.yinwoods.com/"><strong>yinwoods</strong></a>&nbsp;&nbsp;&nbsp;
		分类: <a target="_blank" href="http://blog.yinwoods.com/coding.html"><strong>coding</strong></a>&nbsp;&nbsp;&nbsp;
		日期: <strong>2015年10月11日</strong>&nbsp;&nbsp;&nbsp;
         <ul class="tags post-tags">
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    <li><a href="/tags/cpp/index.html">cpp<span>8</span></a></li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            </ul></p>
</div>
    

    <article class="post-content">
        <hr class="post-end-left"><p class="post-end">开始</p><hr class="post-end-right"/>
        <div>
            <h3>友元函数与友元类</h3>

<p>友元函数可以很方便地处理类的私有数据成员，但是也存在更改私有数据成员值的风险。</p>

<p>举个栗子：</p>

<p>```CPP
class Coordinate {
    friend void printXY(Coordinate &amp;c);
    //friend void Circle::printXY(Coordinate &amp;c);
public:
    Coordinate(int x, int y);
private:
    int m<em>iX;
    int m</em>iY;
};</p>

<p>class Circle {
public:
    void printXY(Coordinate &amp;c) {
        cout &lt;&lt; c.m<em>iX &lt;&lt; c.m</em>iY &lt;&lt; endl;
    }
};</p>

<p>void printXY(Coordinate &amp;c) {//直接访问私有成员
    cout &lt;&lt; c.m<em>iX &lt;&lt; c.m</em>iY &lt;&lt; endl;
}</p>

<p>int main(void) {
    Coordinate coor(3, 5);
    printXY(coor);
    return 0;
}</p>

<p>```</p>

<p>友元类：使用方法与友元函数类似</p>

<p>```CPP
class Circle;
class Coordinate {
    friend Circle;
public:
    Coordinate(int x, int y);
private:
    int m<em>iX;
    int m</em>iY;
};</p>

<p>class Circle {
public:
    void printXY() {
        cout &lt;&lt; m<em>coor.m</em>iX &lt;&lt; &quot; &quot; &lt;&lt; m<em>coor.m</em>iY &lt;&lt; endl;
    }
private:
    Coordinate coor;
}</p>

<p>```</p>

<p>友元注意事项：</p>

<blockquote>
<ul>
<li><p>友元关系不可传递</p></li>
<li><p>友元关系的单向性</p></li>
<li><p>友元声明的形式及数量不受限制</p></li>
</ul>
</blockquote>

<p><strong>友元是作为封装的补充，破坏了封装性。</strong>在程序架构阶段设计合理是可以避免使用友元的。</p>

<p>类模板中的友元声明：</p>

<p>在<strong>类模板</strong>中可以出现三种友元声明，每一种都声明了与一个或多个实体的友元关系：</p>

<p>1、普通非模板类或函数的友元声明。也即一般的友元声明</p>

<p>2、类模板或函数模块的友元声明。形式如下：</p>

<p><code>CPP
template&lt;typename T&gt; class Foo1;
template&lt;typename Type&gt; class Bar {
    template&lt;typename T&gt; friend class Foo1;
    template&lt;typename T&gt; friend void func();
}
</code></p>

<p>3、只授予对类模板或函数模板的特定实例的访问权的友元声明。形式如下：</p>

<p><code>CPP
template&lt;typename T&gt; class Foo1;
template&lt;typename Type&gt; class Bar {
    //只有当Foo1和func()使用与Bar实例同一模板实参时才是友元，当然也可以为Foo1和func()指定特定的形参类型，比如char*
    template&lt;typename Type&gt; friend class Foo1;
    template&lt;typename Type&gt; friend void func();
}
</code></p>

<h3>静态成员static</h3>

<p>静态数据成员依赖于类，因此即使没有实例化一个类，也可以使用静态数据成员，使用<code>Class::mem</code>形式使用。</p>

<p>不能在静态成员函数中使用非静态数据成员（<strong>因为静态成员函数的参数中不默认包含this指针</strong>）</p>

<p>注意事项：</p>

<blockquote>
<ul>
<li><p>静态数据成员必须单独初始化</p></li>
<li><p>静态成员函数不能调用非静态成员函数和非静态数据成员</p></li>
<li><p>静态数据成员只有一份，且不依赖对象而存在（例如sizeof(对象)的值不包含静态数据成员）</p></li>
</ul>
</blockquote>

<h3>运算符重载</h3>

<p>可以通过友元函数重载、成员函数重载两种方法完成。二者的区别在于成员函数比友元函数少了操作符操作对象本身这个参数。</p>

<p>但对于&lt;&lt;、&gt;&gt;操作符只能用友元函数重载，原因是此时的操作符操作对象不可省略。</p>

<p>[]操作符只能用成员函数重载，原因是参数中必须有this指针。</p>

<p>形式为<code>Class &amp;operator运算符(){};</code></p>

<p>对于类Coordinate：</p>

<p><code>CPP
class Coordinate {
public:
    Coordinate(int x, int y) {
        m_iX = x;
        m_iY = y;
    }
private:
    int m_iX, m_iY;
}
</code></p>

<p>例如对于+运算符(两种形式)：</p>

<p><code>CPP
friend Coordinate &amp;operator+(const Coordinate &amp;coor1, const Coordinate &amp;coor2) {
    Coordinate tmp(0, 0);
    tmp.m_iX = coor1.m_iX + coor2.m_iX;
    tmp.m_iY = coor1.m_iY + coor2.m_iY;
    return tmp;
}
Coordinate &amp;operator+(const Coordinate &amp;coor) {
    Coordinate tmp(0, 0);
    tmp.m_iX = this-&gt;m_iX + coor.m_iX;
    tmp.m_iY = this-&gt;m_iY + coor.m_iY;
    return tmp;
}
</code></p>

<p>对于&lt;&lt;操作符：</p>

<p><code>CPP
friend ostream &amp;operator(ostream out, const Coordinate &amp;coor) {
    out &lt;&lt; coor.m_iX &lt;&lt; &quot;, &quot; &lt;&lt; coor.m_iY &lt;&lt; endl;
    return out;
}
</code></p>

<p>对于[]操作符：</p>

<p><code>CPP
int &amp;operator[](int index) {
    if(index == 0) {
        return m_iX;
    }
    if(index == 1) {
        return m_iY;
    }
}
</code></p>

<p>这种形式会引发一个问题，自操作运算符的重载，比如自增运算符++，这里C++规定<code>返回值 &amp;operator++(){}</code>为前置、
<code>返回值 &amp;operator++(int){}</code>为后置两种形式来区分</p>

<p>前置++：</p>

<p><code>CPP
Coordinate &amp;operator++() {
    ++m_iX;
    ++m_iY;
    return *this;
}
</code></p>

<p>后置++：</p>

<p><code>CPP
Coordinate &amp;operator++(int) {
    Coordinate tmp(*this);
    ++m_iX;
    ++m_iY;
    return tmp;
}
</code></p>

<h3>函数模板</h3>

<p>函数模板用来简化下面的操作，提取函数的共同点。</p>

<p><code>CPP
int max(int a, int b) { return a &gt; b ? a : b; }
float max(float a, float b) { return a &gt; b ? a : b; }
char max(char a, char b) { return a &gt; b ? a : b; }
</code></p>

<p>关键字：<code>template &lt;typename | class&gt;</code></p>

<p><code>class</code>与<code>typename</code>是等效的</p>

<p>使用class</p>

<p>```CPP
template <class T>
T max(T a, T b) {//函数模板
    return a &gt; b ? a : b;
}</p>

<p>//模板函数
int ival = max(100, 99);//可自动识别参数类型
char cval = max<char>(&#39;A&#39;, &#39;B&#39;);//也可指定参数类型
```</p>

<p>使用typename</p>

<p>```CPP
template <typename T>
void swap(T&amp; a, T&amp; b) {
    T tmp = a;
    a = b;
    b = tmp;
}</p>

<p>int x = 20, y = 30;
swap<int>(x, y);
```</p>

<p>模板使用参数</p>

<p>```CPP
template <int size>
void display() {
    cout &lt;&lt; size &lt;&lt; endl;
}</p>

<p>display<10>();
```</p>

<p>多参数函数模板</p>

<p>```CPP
template <typename T, typename C>
void display(T a, C b) {
    cout &lt;&lt; a &lt;&lt; &quot; &quot; &lt;&lt; b &lt;&lt; endl;
}</p>

<p>int a = 1024;
string str = &quot;hello world&quot;;
display<int, string>(a, str);
```</p>

<p>typename 和 class作用相同，可以混用</p>

<p>即：<code>template &lt;typename T, class C&gt;</code></p>

<p>函数模板与重载：</p>

<p>```CPP
template <typename T>
void display(T a);
display<int>(10);</p>

<p>template <typename T>
void display(T a, T b);
display<int>(10, 20);</p>

<p>template <typename T, int size>
void display(T a);
display<int, 5>(10);
```</p>

<h3>类模板</h3>

<p>类模板同函数模板使用方法类似</p>

<p>```CPP
template <class T>
class MyArray {
public:
    void display() {...}
private:
    T *m_pArr;
}</p>

<p>int main(void) {
    MyArray<int> arr;
    arr.display();</p>

<pre><code>return 0;
</code></pre>

<p>}
```</p>

<p>一般来说类模板的声明与定义需要写在一起，即一个头文件中，之所以不能分离是因为链接的时候，需要实例化类模板，而在main函数中只能找到头文件中的声明，没有定义（定义在.cpp文件中，但是因为类模板是在被使用的时候才会实例化，因此.cpp文件中是未实例化的定义），这样的话就会导致连接错误。</p>

<h3>成员模板</h3>

<p>任意类（模板类或非模板类）都可以拥有本身为类模板或函数模板的成员，这种成员称为<strong>成员模板</strong></p>

<p>例如：</p>

<p>```CPP
template<typename Type> class Queue {
public:
    //成员模板
    template<typename It> Queue(It beg, It end) : head(0), end(0) {
        copy<em>elems(beg, end);
    }<br>
    template<typename Iter> void assign(Iter, Iter);
private:
    template<typename Iter> void copy</em>elems(Iter, Iter);
};</p>

<p>//类外定义形式
template<typename T> template<typename Iter>
void Queue<T>::assign(Iter beg, Iter end) {
    destory();
    copy_elems(beg, end);
}
```</p>

<h3>函数模板的特化</h3>

<p>对于下面这个compare模板函数，如果我们尝试给它传递两个char*的实参，函数将会比较两个指针的大小，而不是我们希望的字符串的大小</p>

<p><code>CPP
template&lt;typename T&gt; int compare(const T &amp;v1, const T &amp;v2) {
    if(v1 &lt; v2) return -1;
    if(v2 &lt; v1) return 1;
    return 0;
}
</code></p>

<p>为了方便地解决这种问题，C++引入了<strong>模板特化</strong>！</p>

<p>模板特化：该定义中有一个或多个模板形参的实际类型或实际值是指定的。定义形式如下：</p>

<blockquote>
<ul>
<li><p>关键字template后面接一对空的尖括号&lt;&gt;</p></li>
<li><p>再接模板名和一对尖括号，尖括号中指定这个特化定义的模板形参</p></li>
</ul>
</blockquote>

<p>例如我们可以将compare函数特化为：</p>

<p><code>CPP
template&lt;&gt; 
int compare(const char*)(const char* const &amp;v1, const char* const &amp;v2) {
    return strcmp(v1, v2);
}
</code></p>

<p>这样当我们调用compare(&quot;hello&quot;, &quot;world&quot;)时就不会再出错了！当然如果使用其他类型的实参仍会调用compare的通用版本。</p>

<p>注意<code>template&lt;&gt;</code>不可省略，否则声明定义的是该函数的重载非模板版本。</p>

<p>模板类的特化以及模板类的模板成员函数特化与模板函数特化形式上类似。</p>

<p>上面讲述的是模板的完全特化，对于有多个模板参数的模板类或模板函数我们还可以做到模板的部分特化，比如有类<code>template&lt;typename T, typename U&gt; class EXP</code>，则我们可以使用<code>template&lt;typename T, string&gt; class EXP</code>的形式完成模板的部分特化。</p>

<h3>重载与函数模板</h3>

<p>函数模板可以重载，可以定义有相同名字但形参数目不同或类型不同的多个函数模板，也可以定义与函数模板有相同名字的普通非模板函数。</p>

<p>C++ OOP特性还可参考本站其他相关博文：</p>

<blockquote>
<p><a href="http://blog.yinwoods.com/coding/c%E4%B8%AD%E7%9A%84%E5%A4%9A%E6%80%81.html">C++ 【oop】封装篇</a></p>

<p><a href="http://blog.yinwoods.com/coding/c-oop%E7%BB%A7%E6%89%BF%E7%AF%87.html">C++ 【oop】继承篇</a></p>

<p><a href="http://blog.yinwoods.com/coding/coop%E5%A4%9A%E6%80%81%E7%AF%87.html">C++ 【oop】多态篇</a></p>
</blockquote>

        </div>
        <hr class="post-end-left"><p class="post-end">结束</p><hr class="post-end-right"/>
        <div class="post-footer">
            
            <p class="post-footer-previous">上一篇 ： <a class="entry-more" href="/coding/coop%E5%A4%9A%E6%80%81%E7%AF%87.html">C++【OOP】多态篇</a></p>
            
            
            <p class="post-footer-next">下一篇 ： <a class="entry-more" href="/coding/c%E4%B8%AD%E4%B8%A4%E4%B8%AA%E7%B1%BB%E7%9B%B8%E4%BA%92%E5%BC%95%E7%94%A8%E7%9A%84%E9%97%AE%E9%A2%98.html">C++中两个类相互引用的问题</a></p>
            
        </div>
    <!-- JiaThis Button BEGIN -->
    <div class="jiathis_style">
        <span style="font-family:sans-serif; color:#009966">分享到：</span>
        <a class="jiathis_button_weixin share_button" href="#"></a>
        <a class="jiathis_button_tsina share_button" href="#"></a>
        <a class="jiathis_button_qzone share_button" href="#"></a>
        <a class="jiathis_button_evernote share_button" href="#"></a>
        <a class="jiathis_button_ydnote share_button" href="#"></a>
        <a class="jiathis_button_pocket share_button" href="#"></a>
        <a class="jiathis_button_douban share_button" href="#"></a>
        <a class="jiathis_button_renren share_button" href="#"></a>
        <a class="jiathis_button_fb share_button" href="#"></a>
        <a class="jiathis_button_linkedin share_button" href="#"></a>
        <a class="jiathis_button_googleplus share_button" href="#"></a>
        <a class="jiathis_button_tumblr share_button" href="#"></a>
        <a class="jiathis_counter_style"></a>
    </div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<script type="text/javascript" src="/js/totop.js" charset="utf-8"></script>
<!-- JiaThis Button END -->
</article>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'yinwoods'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    



		</div>
					<footer class="footer">
				<div class="row">
					<div class="pull-left">
						<a class="avatar" href="/" title="yinwoods">yinwoods</a>
                        			<p class="copyright">2015 ALL RIGHTS RESERVED</p>
					</div>
					
					<div class="pull-center">
						<h4>Powered by <a target="_blank" href="https://github.com/yinwoods">github</a> && <a target="_blank" href="http://jekyllrb.com/">jekyll</a></h4>
					</div>
				</div>
			</footer>

				<nav id="menu" class="menu">
			<ul>
				<li class="logo"><a href="about.html"><img  class="img-circle" height="100px" width="100px" src="/img/about/me.png"></a></li>

				<li><a href="/index.html"><span class="glyphicon glyphicon-home"></span></i> 首页 </a></li>
				
				<li><a href="/coding.html"><span class="glyphicon glyphicon-road"></span></i>  编程之路 </a></li>

				<li><a href="/myshare.html"><span class="glyphicon glyphicon-gift"></span>  我的分享 </a></li>
				
				<li><a href="/diary.html"><span class="glyphicon glyphicon-calendar"></span></i>  生活日志 </a></li>
				
				<li><a href="/book-movie-list/booklist.html"><span class="glyphicon glyphicon-inbox"></span></i>  书单/影单  </a></li>

				<li><a href="/about.html"><span class="glyphicon glyphicon-sunglasses"></span></i>  关于博主 </a></li>

				<li><a href="/friend.html"><span class="glyphicon glyphicon-send"></span></i> 我的朋友 </a></li>

				<li><img class="img-rounded" height="100px" width="100%" src="/img/about/footer.png"></li>

			</ul>
			<button id="btnClose" class="btn-close"></button>

			<div id="SVGMenu" class="svg-menu" 
                data-menu-open="M-7.312,0H15c0,0,66,113.339,66,399.5C81,664.006,15,800,15,800H-7.312V0z;M-7.312,0H100c0,0,0,113.839,0,400c0,264.506,0,400,0,400H-7.312V0z" 
                data-menu-close="M-6,0h101c0,0-90,153.603-90,396.167C2.167,627.579,100,800,100,800H-1V0z;M-7.312,0H100c0,0,0,113.839,0,400c0,264.506,0,400,0,400H-7.312V0z">
				<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 100 800" preserveAspectRatio="none">
					<path d="M-7.312,0H0c0,0,0,113.839,0,400c0,264.506,0,400,0,400h-7.312V0z"/>
				</svg>
			</div>

		</nav>


		<div id="totop">
    			<a title="返回顶部">返回顶部</a>
		</div>
	</div>

	<script type="text/javascript" src="/js/classie.js"></script>

	<script type="text/javascript" src="/js/snap.svg-min.js"></script>
	<script type="text/javascript" src="/js/menuTriggle.js"></script>
	<script type="text/javascript" src="/js/SVGButton.js"></script>

	<script type="text/javascript" src="/js/postTriggle.js"></script>

	
	<script type="text/javascript" src="/js/jquery-2.1.1.min.js"></script>
	<script type="text/javascript" src="/js/totop.js"></script>
	<script type="text/javascript">
		var content = document.querySelector('.content'),
			footer = document.querySelector('.footer'),
			footT  = footer.offsetTop,
			footH  = footer.offsetHeight,
			winH   = window.innerHeight,
			post   = document.querySelectorAll('p');

		if (footT - footH + 100 < winH) {
			content.style.height = '100%';
		};

		for (var i = 0; i < post.length; i++) {
			if (post.item(i).querySelector('img')) {
				post.item(i).style.textIndent = 0;
			};
		};

	</script>
	<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?eefd87bbdb3a5e21ecb7f319769dd8b9";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</body>
</html>
